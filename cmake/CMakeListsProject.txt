project(libziparchive LANGUAGES CXX)

set(ANDROID_SOURCES
    ${LIBZIPARCHIVE_ROOT}/android-base/errno_restorer.h
    ${LIBZIPARCHIVE_ROOT}/android-base/file.cpp
    ${LIBZIPARCHIVE_ROOT}/android-base/file.h
    ${LIBZIPARCHIVE_ROOT}/android-base/log_main.h
    ${LIBZIPARCHIVE_ROOT}/android-base/logging.h
    ${LIBZIPARCHIVE_ROOT}/android-base/macros.h
    ${LIBZIPARCHIVE_ROOT}/android-base/off64_t.h
    ${LIBZIPARCHIVE_ROOT}/android-base/parseint.h
    ${LIBZIPARCHIVE_ROOT}/android-base/stringprintf.cpp
    ${LIBZIPARCHIVE_ROOT}/android-base/stringprintf.h
    ${LIBZIPARCHIVE_ROOT}/android-base/strings.cpp
    ${LIBZIPARCHIVE_ROOT}/android-base/strings.h
    ${LIBZIPARCHIVE_ROOT}/android-base/threads.h
    ${LIBZIPARCHIVE_ROOT}/android-base/unique_fd.h
    ${LIBZIPARCHIVE_ROOT}/android-base/utf8.h
)

set(LIBZIPARCHIVE_SOURCES
    ${LIBZIPARCHIVE_ROOT}zip_archive.cc
    ${LIBZIPARCHIVE_ROOT}zip_archive_stream_entry.cc
    ${LIBZIPARCHIVE_ROOT}zip_cd_entry_map.cc
    ${LIBZIPARCHIVE_ROOT}zip_error.cpp
    ${LIBZIPARCHIVE_ROOT}zip_writer.cc
)

add_library(LIBZIPARCHIVE STATIC ${ANDROID_SOURCES} ${LIBZIPARCHIVE_SOURCES})
target_include_directories(LIBZIPARCHIVE PUBLIC ${LIBZIPARCHIVE_ROOT}/include ${LIBZIPARCHIVE_ROOT}/incfs_support/include)
target_include_directories(LIBZIPARCHIVE PRIVATE ${LIBZIPARCHIVE_ROOT})

set_property(TARGET LIBZIPARCHIVE PROPERTY CXX_STANDARD 20)

if(CMAKE_CXX_COMPILER_ID MATCHES "Clang")
    target_compile_options(LIBZIPARCHIVE PRIVATE $<BUILD_INTERFACE:-Wno-unknown-attributes>)
endif()
